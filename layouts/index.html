{{ define "main" }}
<aside class="sidebar">
  <header class="sidebar-header">
    <h1 class="site-title"><a href="/">{{ .Site.Title }}</a></h1>
    {{ with .Site.Params.description }}<p class="site-tagline">{{ . }}</p>{{ end }}
  </header>
  <nav class="post-list" role="navigation" aria-label="Blog posts">
    {{- $posts := where .Site.RegularPages "Section" "posts" -}}
    {{- $grouped := $posts.GroupByDate "Monday, January 2, 2006" -}}
    {{- range $grouped }}
    <div class="date-group">
      <h2 class="date-header">{{ .Key }}</h2>
      {{- range .Pages }}
      <article class="post-item" data-slug="{{ .RelPermalink }}" tabindex="0">
        <div class="post-item-content">
          <h3 class="post-item-title">{{ .Title }}</h3>
          <p class="post-item-excerpt">{{ .Summary | plainify | htmlUnescape | truncate 100 }}</p>
        </div>
        {{- with .Params.image }}
        <img class="post-item-thumb" src="{{ . }}" alt="Thumbnail for {{ $.Title }}" loading="lazy">
        {{- end }}
      </article>
      {{- end }}
    </div>
    {{- end }}
  </nav>
</aside>
<main class="content" role="main">
  <div class="sr-only" aria-live="polite" id="article-announcement"></div>
  <article class="article" id="article-content">
    {{- with (index (where .Site.RegularPages "Section" "posts") 0) }}
    {{- partial "article.html" . }}
    {{- else }}
    <div class="empty-state">
      <p>No posts yet. Add your first post to content/posts/</p>
    </div>
    {{- end }}
  </article>
</main>

<script id="posts-data" type="application/json">
{{- $posts := where .Site.RegularPages "Section" "posts" -}}
{{- $data := slice -}}
{{- range $p := $posts -}}
  {{- $item := dict "slug" $p.RelPermalink "title" $p.Title "date" ($p.Date.Format "January 2, 2006") "readingTime" $p.ReadingTime "content" $p.Content "image" $p.Params.image -}}
  {{- $data = $data | append $item -}}
{{- end -}}
{{ $data | jsonify (dict "indent" "  ") | safeJS }}
</script>
{{ end }}
