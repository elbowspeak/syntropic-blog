{{ define "main" }}
<aside class="sidebar">
  <header class="sidebar-header">
    <h1 class="site-title">Essays</h1>
    <p class="site-tagline">Long-form on intelligence, entropy, and complex systems</p>
  </header>
  <nav class="post-list" role="navigation" aria-label="Essays">
    {{- $posts := .Pages -}}
    {{- $grouped := $posts.GroupByDate "Monday, January 2, 2006" -}}
    {{- range $grouped }}
    <div class="date-group">
      <h2 class="date-header">{{ .Key }}</h2>
      {{- range .Pages }}
      <article class="post-item" data-slug="{{ .RelPermalink }}" tabindex="0">
        <div class="post-item-content">
          <h3 class="post-item-title">{{ .Title }}</h3>
          <p class="post-item-excerpt">{{ with .Params.subtitle }}{{ . }}{{ else }}{{ .Summary | plainify | htmlUnescape | truncate 100 }}{{ end }}</p>
        </div>
        {{- with .Params.image }}
        <img class="post-item-thumb" src="{{ . }}" alt="" loading="lazy">
        {{- end }}
      </article>
      {{- end }}
    </div>
    {{- end }}
  </nav>
</aside>
<main class="content" role="main">
  <article class="article" id="article-content">
    {{- with (index .Pages 0) }}
    {{- partial "article.html" . }}
    {{- else }}
    <div class="empty-state">
      <p>No essays yet.</p>
    </div>
    {{- end }}
  </article>
</main>

<script id="posts-data" type="application/json">
{{- $posts := .Pages -}}
{{- $data := slice -}}
{{- range $p := $posts -}}
  {{- $item := dict "slug" $p.RelPermalink "title" $p.Title "subtitle" $p.Params.subtitle "date" ($p.Date.Format "January 2, 2006") "readingTime" $p.ReadingTime "content" $p.Content "image" $p.Params.image "image_caption" $p.Params.image_caption -}}
  {{- $data = $data | append $item -}}
{{- end -}}
{{ $data | jsonify (dict "indent" "  ") | safeJS }}
</script>
{{ end }}
